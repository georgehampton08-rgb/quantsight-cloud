rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // =========================================================================
    // PUBLIC READ - Mobile App Accessible Collections
    // =========================================================================
    
    // Live Games: Real-time game scores and player stats
    match /live_games/{game_id} {
      allow read: if true;
      allow write: if false; // Backend service account writes via Admin SDK
      
      match /players/{player_id} {
        allow read: if true;
        allow write: if false;
      }
      
      match /alpha_spikes/{spike_id} {
        allow read: if true;
        allow write: if false;
      }
    }
    
    // Live Leaders: Top performers leaderboard
    match /live_leaders/{document=**} {
      allow read: if true;
      allow write: if false;
    }
    
    // Alpha Spikes: Significant stat explosions
    match /alpha_spikes/{spike_id} {
      allow read: if true;
      allow write: if false;
    }
    
    // Team Defense: Defensive ratings for matchup analysis
    match /team_defense/{team_id} {
      allow read: if true;
      allow write: if false;
    }
    
    // Players Index: Full player list for search autocomplete
    match /players_index/{player_id} {
      allow read: if true;
      allow write: if false;
    }
    
    // Player Projections (Legacy)
    match /player_projections/{projection_id} {
      allow read: if true;
      allow write: if false;
    }
    
    // =========================================================================
    // ALPHA PROTECTION - Proprietary Data (NEVER expose publicly)
    // =========================================================================
    
    // Player Rolling Averages: Contains proprietary Heat Scale calculations
    // ⚠️ CRITICAL: This powers our competitive advantage
    match /player_rolling_averages/{document=**} {
      allow read: if false;   // DENY all public access
      allow write: if false;  // Only Cloud SQL holds this data
    }
    
    // Alpha Metrics: Internal analytics
    match /alpha_metrics/{document=**} {
      allow read: if false;
      allow write: if false;
    }
    
    // =========================================================================
    // DEFAULT DENY - Catch-all for undefined collections
    // =========================================================================
    
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
