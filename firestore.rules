rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // === Live Games Collection ===
    // Public read for all users, write ONLY from backend
    match /live_games/{game_id} {
      // Anyone can read live game data
      allow read: if true;
      
      // Only backend service account can write
      allow write: if false;
      
      // Players subcollection (detailed player stats)
      match /players/{player_id} {
        allow read: if true;
        allow write: if false;
      }
      
      // Alpha spikes subcollection (high-value events)
      // Requires authentication to prevent abuse
      match /alpha_spikes/{spike_id} {
        allow read: if request.auth != null;
        allow write: if false;
      }
    }
    
    // === Team Defense Collection ===
    // Read-only defensive ratings for matchup analysis
    match /team_defense/{team_id} {
      allow read: if true;
      allow write: if false;
    }
    
    // === Player Projections (Legacy) ===
    match /player_projections/{projection_id} {
      allow read: if true;
      allow write: if false;
    }
    
    // Deny all other access by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
